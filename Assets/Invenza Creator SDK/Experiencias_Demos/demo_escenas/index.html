<!DOCTYPE doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width, shrink-to-fit=no" name="viewport">
    <title>
        Prueba Panolens
    </title>
    <script src="js/three.min.js">
    </script>
    <script src="js/panolens.min.js	">
    </script>
    <script src="js/GLTFLoader.js	">
    </script>
    <script src="js/FBXLoader.js">
    </script>
    <script src="js/inflate.min.js">
    </script>
    <script src="js/ColladaLoader.js"></script>



    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            margin: 0;
        }
        
        #container {
            width: 100%;
            height: 100%;
        }
    </style>
    </meta>
    </meta>
</head>

<body>

    <video id="Hotspot1btn2" loop crossOrigin="anonymous" playsinline style="display:none">
		<source src="asset/Hotspot1btn2.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'>
	</video>

    <video id="Hotspot1btn3" loop crossOrigin="anonymous" playsinline style="display:none">
		<source src="asset/Hotspot1btn2.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'>
	</video>

    <div id="container"></div>

    <script>
        var panorama, panorama, viewer, container, infospot, infospot2;

        container = document.querySelector('#container');

        panorama = new PANOLENS.VideoPanorama('asset/GS010225small_1.mp4', {
            autoplay: true
        });



        viewer = new PANOLENS.Viewer({
            container: container,
            output: 'console'
        });
        viewer.add(panorama);

        var video = document.getElementById('Hotspot1btn2');
        //video.play()
        var texture = new THREE.VideoTexture(video);
        texture.minFilter = THREE.LinearFilter;
        texture.magFilter = THREE.LinearFilter;
        texture.format = THREE.RGBFormat;

        var cube = new THREE.Mesh(new THREE.PlaneGeometry(150, 100), new THREE.MeshBasicMaterial({
            map: texture
        }));
        cube.position.set(0, 5, -300);
        //cube.position.set(-152.2096, 94.0241, -39.3369);
        cube.lookAt(0, 0, 0);
        cube.scale.set(0.55, 0.55, 0.55);
        cube.name = 'cube';
        cube.material.needsUpdate = true;
        viewer.addUpdateCallback(function() {
            //cube.rotation.y += 0.05;
            //	var x = cube.rotation.y += 0.005;
            //	console.log(x); 
        });

        const texpanel = new THREE.TextureLoader().load('Models/CanvasMat_MainTex.png.001.png');
        var panel = new THREE.Mesh(new THREE.PlaneGeometry(175, 125), new THREE.MeshBasicMaterial({
            map: texpanel
        }));

        //panel.position.set(-154.2096, 94.0241, -39.3369);
        panel.position.set(0, 0, -302);
        panel.lookAt(0, 0, 0);
        panel.scale.set(0.65, 0.65, 0.65);
        panel.name = 'panel';

        var texvideo = new THREE.TextureLoader().load('Models/BotonVideo.png');
        var botonvideo = new THREE.Mesh(new THREE.PlaneGeometry(16, 13), new THREE.MeshBasicMaterial({
            map: texvideo
        }));
        botonvideo.position.set(-40, -33, -299);
        //botonvideo.lookAt(0, 0, 0);
        botonvideo.scale.set(0.8, 0.8, 0.8);
        botonvideo.name = 'botonvideo';
        botonvideo.addEventListener('click', function() {
            cube.material = new THREE.MeshBasicMaterial({
                map: texture
            })

            if (video.paused) {
                video.play();
            } else {
                video.pause();
            }
        });



        var imgarnes = new THREE.TextureLoader().load('img/arnes.png');
        var teximg = new THREE.TextureLoader().load('Models/invenza_image_ico.png');
        var botonimg = new THREE.Mesh(new THREE.PlaneGeometry(16, 13), new THREE.MeshBasicMaterial({
            map: teximg
        }));
        botonimg.position.set(-25, -33, -299);
        //botonimg.lookAt(0, 0, 0);
        botonimg.scale.set(0.8, 0.8, 0.8);
        botonimg.name = 'botonimagen';
        botonimg.addEventListener('click', function(event) {
            cube.material = new THREE.MeshBasicMaterial({
                map: imgarnes
            })
        });


        var texcerrar = new THREE.TextureLoader().load('Models/Close_MainTex.png');
        var botoncerrar = new THREE.Mesh(new THREE.PlaneGeometry(16, 16), new THREE.MeshBasicMaterial({
            map: texcerrar
        }));
        botoncerrar.position.set(46, -33, -299);
        //botoncerrar.lookAt(0, 0, 0);
        botoncerrar.scale.set(0.8, 0.8, 0.8);
        botoncerrar.name = 'botoncerrar';
        botoncerrar.addEventListener('click', function(event) {
            //group.children[0].visible = false;
            /*group.children.map(function(object) {
                if (object.name == 'cube') {
                    object.visible = false;
                }
            });*/
            group.visible = false;
            console.log("hago click");
        });






        //panorama.add(panel);
        var group = new THREE.Group();
        group.name = "Grupo_de_prueba";
        group.add(cube);
        group.add(panel);
        group.add(botonvideo);
        group.add(botonimg)
        group.add(botoncerrar);
        group.position.set(0, 0, 0);
        //group.lookAt(0, 0, 0);


        panorama.add(group);


        //panorama.add(cube);
        /////////////////////////////////////////////////////////////////////////////////
        infospot = new PANOLENS.Infospot(175, 'img/hsb01.png');
        infospot.name = 'info1';
        //infospot.position.set(-1558.33, 0, -5000);
        infospot.position.set(1094.57, -678.79, -4825.01);
        infospot.addEventListener('click', function() {
            group.visible = true;
        });

        panorama.add(infospot);









        var video2 = document.getElementById('Hotspot1btn3');
        //video.play()
        var texture2 = new THREE.VideoTexture(video2);
        texture2.minFilter = THREE.LinearFilter;
        texture2.magFilter = THREE.LinearFilter;
        texture2.format = THREE.RGBFormat;

        var cube2 = new THREE.Mesh(new THREE.PlaneGeometry(150, 100), new THREE.MeshBasicMaterial({
            map: texture2
        }));
        cube2.position.set(0, 0, 300);
        cube2.name = 'cube2';
        cube2.material.needsUpdate = true;
        //	viewer.addUpdateCallback(function () {
        //cube2.rotation.y += 0.05;
        //var x = cube.rotation.y += 0.005;
        //	console.log(x); 
        //	});

        cube2.rotation.y = Math.PI;
        console.log(cube2.rotation.y);


        panorama.add(cube2);

        infospot2 = new PANOLENS.Infospot(350, 'img/hsb02.png');
        infospot2.name = 'info1';
        //infospot2.position.set(1558.33, -235.84, 4740.29);
        infospot2.position.set(1558.33, 0, 5000);
        infospot2.addEventListener('click', function() {
            cube2.visible = true;
        });

        panorama.add(infospot2);

        /*	infospot2 = new PANOLENS.Infospot(350, PANOLENS.DataImage.Info);
        	infospot2.name = 'info2';
        	infospot2.position.set(0, -1000, -5000);
        	panorama.add(infospot2);*/


        /* 	var cube3 = new THREE.Mesh(new THREE.BoxGeometry(100, 100, 100), new THREE.MeshNormalMaterial());
        	cube3.position.set(0, 0, 300);
        	viewer.addUpdateCallback(function () {
        		cube3.rotation.y += 0.05;
        		cube3.rotation.x += 0.02;
        		//var x = cube3.position.z += 2;
        		//console.log(x);
        	});
        	panorama.add(cube3); */



        panorama.addEventListener('click', function(event) {

            if (event.intersects.length > 0) {

                intersect = event.intersects[0].object;

                if (!(intersect instanceof PANOLENS.Infospot) && intersect.material) {


                    if (intersect.name === 'Play_Mesh.000') {
                        video2.play();
                        console.log('Play');
                    }

                    if (intersect.name === 'Pause_Mesh.000') {
                        video2.pause();
                        console.log('Play');
                    }

                    if (intersect.name === 'info1') {
                        addVideo(intersect);
                        console.log('info1');
                    }

                }
                if (intersect.name === 'info1') {
                    //	addVideo2(intersect);
                    console.log('info1');
                }
                /*if (intersect.name === 'cube') {
                    if (video.paused) {
                        video.play();
                    } else {
                        video.pause();
                    }
                }*/

                if (intersect.name === 'cube2') {
                    if (video2.paused) {
                        video2.play();
                    } else {
                        video2.pause();
                    }
                }
                /*if (intersect.name == 'botoncerrar') {
                    group.visible = false;
                }*/
                console.log(intersect);
            }

        });
    </script>
</body>

</html>