<!DOCTYPE doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width, shrink-to-fit=no" name="viewport">
    <title>
        Prueba Panolens
    </title>
    <script src="js/three.min.js">
    </script>
    <script src="js/panolens.min.js ">
    </script>
    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            margin: 0;
        }
        
        #container {
            width: 100%;
            height: 100%;
        }
    </style>
    </meta>
    </meta>
</head>

<body>
    <video crossorigin="anonymous" id="Hotspot1btn2" loop="" playsinline="" style="display:none">
            <source src="asset/Hotspot1btn2.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'>
            </source>
        </video>
    <video crossorigin="anonymous" id="Hotspot1btn3" loop="" playsinline="" style="display:none">
            <source src="asset/Hotspot1btn2.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'>
            </source>
        </video>
    <div id="container">
    </div>
    <script>
        var panorama, panorama, viewer, container, infospot, infospot2;
        const pathImg = 'img/arnes.png&&img/arnesazul.png';
        var arrayImgs = pathImg.split('&&');
        var pivot = 0;
        var pivotType;
        container = document.querySelector('#container');

        panorama = new PANOLENS.VideoPanorama('asset/GS010225small_1.mp4', {
            autoplay: true
        });

        var panelOne = new THREE.Group();

        viewer = new PANOLENS.Viewer({
            container: container,
            output: 'console'
        });
        viewer.add(panorama);

        var video = document.getElementById('Hotspot1btn2');
        var texture = new THREE.VideoTexture(video);
        texture.minFilter = THREE.LinearFilter;
        texture.magFilter = THREE.LinearFilter;
        texture.format = THREE.RGBFormat;

        var frameLayout = new THREE.Mesh(new THREE.PlaneGeometry(150, 100), new THREE.MeshBasicMaterial({
            map: texture
        }));
        frameLayout.position.set(0, 7, -300);
        frameLayout.lookAt(0, 0, 0);
        frameLayout.scale.set(0.65, 0.65, 0.65);
        frameLayout.name = 'frameLayout';
        frameLayout.material.needsUpdate = true;




        viewer.addUpdateCallback(function() {

        });

        const texpanel = new THREE.TextureLoader().load('Models/CanvasMat_MainTex.png.001.png');
        var panel = new THREE.Mesh(new THREE.PlaneGeometry(175, 125), new THREE.MeshBasicMaterial({
            map: texpanel
        }));

        //panel.position.set(-154.2096, 94.0241, -39.3369);
        panel.position.set(0, 0, -302);
        panel.lookAt(0, 0, 0);
        panel.scale.set(0.65, 0.65, 0.65);
        panel.name = 'Panel1';

        var btnPrevText = new THREE.TextureLoader().load('Models/prev_ico.png');
        var btnPrev = new THREE.Mesh(new THREE.PlaneGeometry(16, 16), new THREE.MeshBasicMaterial({
            map: btnPrevText
        }));
        btnPrev.position.set(15, -33, -299);
        btnPrev.scale.set(0.8, 0.8, 0.8);
        btnPrev.name = 'btnPrevP1';
        btnPrev.addEventListener('click', function(event) {
            if (pivot > 0) {
                var texture = new THREE.TextureLoader().load(arrayImgs[--pivot]);
                frameLayout.material = new THREE.MeshBasicMaterial({
                    map: texture
                });
            }
            console.log(pivot);
        });

        var btnNextText = new THREE.TextureLoader().load('Models/next_ico.png');
        var btnNext = new THREE.Mesh(new THREE.PlaneGeometry(16, 16), new THREE.MeshBasicMaterial({
            map: btnNextText
        }));
        btnNext.position.set(30, -33, -299);
        btnNext.scale.set(0.8, 0.8, 0.8);
        btnNext.name = 'btnNextP1';
        btnNext.addEventListener('click', function(event) {
            if (pivot < arrayImgs.length - 1) {
                var texture = new THREE.TextureLoader().load(arrayImgs[++pivot]);
                frameLayout.material = new THREE.MeshBasicMaterial({
                    map: texture
                });
            }

            console.log(pivot + " - " + arrayImgs.length);
        });


        var btnPlayText = new THREE.TextureLoader().load('Models/Play_MainTex.png');
        var btnPlay = new THREE.Mesh(new THREE.PlaneGeometry(16, 16), new THREE.MeshBasicMaterial({
            map: btnPrevText
        }));
        btnPlay.position.set(15, -33, -299);
        btnPlay.scale.set(0.8, 0.8, 0.8);
        btnPlay.name = 'btnPlay';
        btnPlay.addEventListener('click', function(event) {
            video.play();
        });

        var btnPauseText = new THREE.TextureLoader().load('Models/Pause_MainTex.png');
        var btnPause = new THREE.Mesh(new THREE.PlaneGeometry(16, 16), new THREE.MeshBasicMaterial({
            map: btnNextText
        }));
        btnPause.position.set(30, -33, -299);
        btnPause.scale.set(0.8, 0.8, 0.8);
        btnPause.name = 'btnPause';
        btnPause.addEventListener('click', function(event) {
            video.pause();
            console.log(panelOne.children[0].material.map.image.id);
        });

        var texvideo = new THREE.TextureLoader().load('Models/invenza_video_ico.png');
        var botonvideo = new THREE.Mesh(new THREE.PlaneGeometry(16, 13), new THREE.MeshBasicMaterial({
            map: texvideo
        }));
        botonvideo.position.set(-45, -33, -299);
        //botonvideo.lookAt(0, 0, 0);
        botonvideo.scale.set(0.8, 0.8, 0.8);
        botonvideo.name = 'botonvideo';
        botonvideo.addEventListener('click', function() {

            frameLayout.material = new THREE.MeshBasicMaterial({
                map: texture
            });

            if (video.paused) {
                video.play();
            } else {
                video.pause();
            }

            panelOne.remove(btnPrev);
            panelOne.remove(btnNext);
            panelOne.add(btnPlay);
            panelOne.add(btnPause);
        });



        var imgarnes = new THREE.TextureLoader().load(arrayImgs[0]);
        var teximg = new THREE.TextureLoader().load('Models/invenza_image_ico.png');
        var botonimg = new THREE.Mesh(new THREE.PlaneGeometry(16, 13), new THREE.MeshBasicMaterial({
            map: teximg
        }));
        botonimg.position.set(-29, -33, -299);
        //botonimg.lookAt(0, 0, 0);
        botonimg.scale.set(0.8, 0.8, 0.8);
        botonimg.name = 'botonimagen';
        botonimg.addEventListener('click', function(event) {
            panelOne.add(btnPrev);
            panelOne.add(btnNext);
            panelOne.remove(btnPlay);
            panelOne.remove(btnPause);

            stopVideo();
            frameLayout.material = new THREE.MeshBasicMaterial({
                map: imgarnes
            })
        });


        var texText = new THREE.TextureLoader().load('Models/invenza_text_ico.png');
        var botonText = new THREE.Mesh(new THREE.PlaneGeometry(16, 13), new THREE.MeshBasicMaterial({
            map: texText
        }));
        botonText.position.set(-14, -33, -299);
        botonText.scale.set(0.8, 0.8, 0.8);
        botonText.name = 'botonimagen';
        botonText.addEventListener('click', function(event) {
            stopVideo();
            panelOne.add(btnPrev);
            panelOne.add(btnNext);
            panelOne.remove(btnPlay);
            panelOne.remove(btnPause);

        });


        var texcerrar = new THREE.TextureLoader().load('Models/Close_MainTex.png');
        var botoncerrar = new THREE.Mesh(new THREE.PlaneGeometry(16, 16), new THREE.MeshBasicMaterial({
            map: texcerrar
        }));
        botoncerrar.position.set(46, -33, -299);
        botoncerrar.scale.set(0.8, 0.8, 0.8);
        botoncerrar.name = 'botoncerrar';
        botoncerrar.addEventListener('click', function(event) {
            panelOne.visible = false;
            console.log("hago click");
            stopVideo();
        });

        panelOne.name = "Grupo_de_prueba";
        panelOne.add(frameLayout);
        panelOne.add(panel);
        panelOne.add(botonvideo);
        panelOne.add(botonimg);
        panelOne.add(botonText);
        panelOne.add(botoncerrar);
        panelOne.position.set(0, 0, 0);
        panelOne.scale.set(2.5, 2.5, 2.5);

        panorama.add(panelOne);


        //panorama.add(cube);
        /////////////////////////////////////////////////////////////////////////////////
        infospot = new PANOLENS.Infospot(175, 'img/hsb01.png');
        infospot.name = 'info1';
        infospot.position.set(1094.57, -678.79, -4825.01);
        infospot.addEventListener('click', function() {
            panelOne.visible = true;
        });

        panorama.add(infospot);

        panorama.addEventListener('click', function(event) {

            if (event.intersects.length > 0) {

                intersect = event.intersects[0].object;

                if (!(intersect instanceof PANOLENS.Infospot) && intersect.material) {


                    if (intersect.name === 'Play_Mesh.000') {
                        video2.play();
                        console.log('Play');
                    }

                    if (intersect.name === 'Pause_Mesh.000') {
                        video2.pause();
                        console.log('Play');
                    }

                    if (intersect.name === 'info1') {
                        addVideo(intersect);
                        console.log('info1');
                    }

                }
                if (intersect.name === 'info1') {
                    //  addVideo2(intersect);
                    console.log('info1');
                }


                if (intersect.name === 'cube2') {
                    if (video2.paused) {
                        video2.play();
                    } else {
                        video2.pause();
                    }
                }
                console.log(intersect);
            }

        });

        function stopVideo() {

            var videosTag = document.getElementsByTagName("video");

            for (var i = videosTag.length - 1; i >= 0; i--) {
                videosTag[i].pause();
            }
        }
    </script>
</body>

</html>